<div class="form--container" mat-dialog-content>
  <form novalidate (ngSubmit)="onSubmit()" [formGroup]="formCtrl">
    <lib-form-section
      title="New Secret"
      text="Create a new Secret."
      icon="fa-solid:fa-key"
      i18n-title
      i18n-text
    >
    </lib-form-section>

    <!--Name / Namespace-->
    <lib-form-name-namespace-inputs
      [nameControl]="formCtrl.get('name')"
      [namespaceControl]="formCtrl.get('namespace')"
      resourceName="Secret"
      i18n-resourceName
      [existingNames]="existingSecretsNames"
    >
    </lib-form-name-namespace-inputs>

    <!--Storage Class-->
    <mat-form-field appearance="outline" class="wide">
      <mat-label i18n>Secret Type</mat-label>
      <mat-select formControlName="secretType" data-cy-form-control-name-class>
        <mat-option *ngFor="let st of secretTypes" [value]="st">
          {{ st }}
        </mat-option>
      </mat-select>
    </mat-form-field>



    <!-- Secret fields -->

    <lib-form-section
      title="Secret data"
      text="Each secrets contains key value data"
      i18n-title
      i18n-text
    >
      <mat-accordion>
        <mat-expansion-panel
          hideToggle
          *ngFor="
        let fieldGroup of fieldsArray.controls;
        let i = index;
        let last = last
      "
          (opened)="openPanel.add(i)"
          (closed)="openPanel.clear()"
          [class.last]="last"
          data-cy="data volumes"
        >

          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ getFieldName(fieldGroup) }}
            </mat-panel-title>

            <mat-panel-description>
              <div class="icons">
                <mat-icon
                  *ngIf="isOpaque()"
                  (click)="onDelete(i, $event)"
                  matTooltip="Delete volume"
                  i18n-matTooltip
                  class="delete-icon"
                >
                  delete
                </mat-icon>

                <mat-icon
                  *ngIf="!openPanel.has(i)"
                  matTooltip="Show volume details"
                  i18n-matTooltip
                >
                  expand_more
                </mat-icon>

                <mat-icon
                  *ngIf="openPanel.has(i)"
                  matTooltip="Hide volume details"
                  i18n-matTooltip
                >
                  expand_less
                </mat-icon>
              </div>
            </mat-panel-description>
          </mat-expansion-panel-header>

          <div>

            <!-- field key -->
            <mat-form-field appearance="outline" class="wide">
              <mat-label i18n>Field name</mat-label>
              <input
                autocomplete="off"
                matInput
                [attr.readonly]="!isOpaque()"
                [formControl]="fieldGroup.get('key')"
                data-cy="key"
              />
            </mat-form-field>

            <!-- field data -->
            <mat-form-field appearance="outline" class="wide">
              <mat-label i18n>Data</mat-label>
              <input
                autocomplete="off"
                matInput
                [formControl]="fieldGroup.get('data')"
                data-cy="data"
              />
            </mat-form-field>
          </div>
        </mat-expansion-panel>
      </mat-accordion>

      <div class="secrets-button" >
        <button
          *ngIf="isOpaque()"
          type="button"
          color="primary"
          (click)="addNewSecretField()"
          mat-stroked-button
          i18n
          data-cy="add new field"
          class="add-field-button"
        >
          + Add new field
        </button>
      </div>
    </lib-form-section>


    <button
      mat-raised-button
      color="primary"
      class="form--button-margin"
      type="submit"
      [disabled]="!formCtrl.valid || blockSubmit"
      data-cy-button-create
      i18n
    >
      CREATE
    </button>

    <button
      mat-raised-button
      type="button"
      (click)="onCancel()"
      i18n
      data-cy-button-cancel
    >
      CANCEL
    </button>
  </form>
</div>
